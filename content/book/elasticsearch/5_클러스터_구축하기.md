# 2주차 (p109 ~ p144)

## elasticsearch.yml
- cluster
```yml
cluster.name: es-search
```
- node
```yml
# data-group1
node.name: unifiedsearch-group1-ec2id
node.roles: [ data ]
node.attr.data: group1
```
```yml
# data-group2
node.name: unifiedsearch-group2-ec2id
node.roles: [ data ]
node.attr.data: group2
```
```yml
# coordinating
node.name: search-coordinating-indexer
node.roles: []
```

- memory
```yml
bootstrap.memory_lock: true 
```
시스템의 스왑 메모리 영역을 사용하지 않도록 하는 설정

- network
```yml
network.host: 0.0.0.0
http.port: 11200
transport.tcp.port: 11300
http.max_content_length: 1024mb
```

- discovery
```yaml
discovery.seed_hosts: ["ip list"] # 클러스터링 할 노드 
cluster.initial_master_nodes: ["search-master1", "search-master2", "search-master3"]
```

> **split brain 현상 방지**
> - minimum_master_nodex값을 과반수로 설정
> - (total number of master-eligible nodes / 2) + 1


노드 역할 분리
- 요청을 받는 노드와 색인 및 검색에 사용하는 노드를 분리
- 힙메모리 리소스 확보

## jvm.options 설정파일
- xms: 최소값
- xmx: 최대값
  - 같게 설정 권고

- 32기가 언더로
- 전체 메모리의 절반을 힙메모리로 할당

```text
_cat/health
epoch      timestamp cluster   status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent
1664885334 12:08:54  es-search green          23        11    973 479    0    0        0             0                  -                100.0%
```

unassigned shard
- 샤드가 어떤 노드에도 배치되지 못한 상태